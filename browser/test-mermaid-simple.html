<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mermaid Plugin Simple Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      padding: 20px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: #f8fafc;
    }
    
    .test-section h3 {
      margin-top: 0;
      color: #374151;
    }
    
    .button {
      padding: 8px 16px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .button:hover {
      background: #2563eb;
    }
    
    .output {
      background: white;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #e5e7eb;
      margin-top: 15px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="module">
    import { createApp, h } from 'vue'
    import { TiptapEditorCapsule } from './packages/tiptap-capsule/src/index.ts'

    // 创建Vue应用
    const app = createApp({
      components: {
        TiptapEditorCapsule
      },
      data() {
        return {
          content: `<h1>Mermaid 插件简单测试</h1>
<p>点击工具栏中的 Mermaid 按钮来插入图表。</p>
<p>插入的图表支持编辑和查看两种模式。</p>`,
          enableVueTextBtnDemo: false,
          htmlOutput: '',
          jsonOutput: '',
          testResults: []
        }
      },
      methods: {
        handleUpdate(value) {
          this.content = value
        },
        handleHtmlChanged(html) {
          this.htmlOutput = html
        },
        handleJsonChanged(json) {
          this.jsonOutput = JSON.stringify(json, null, 2)
        },
        addTestResult(result) {
          this.testResults.push({
            timestamp: new Date().toLocaleTimeString(),
            result: result
          })
        },
        testMermaidInsert() {
          this.addTestResult('尝试插入 Mermaid 图表...')
        },
        clearOutput() {
          this.htmlOutput = ''
          this.jsonOutput = ''
          this.testResults = []
        }
      },
      render() {
        return h('div', { class: 'container' }, [
          h('h1', 'Mermaid 插件简单测试'),
          
          h('div', { class: 'test-section' }, [
            h('h3', '编辑器测试'),
            h('p', '使用下面的编辑器测试 Mermaid 功能：'),
            h(TiptapEditorCapsule, {
              modelValue: this.content,
              'onUpdate:modelValue': this.handleUpdate,
              onHtmlPresentChanged: this.handleHtmlChanged,
              onJsonPresentChanged: this.handleJsonChanged,
              enableVueTextBtnDemo: this.enableVueTextBtnDemo,
              showOutput: false,
            })
          ]),
          
          h('div', { class: 'test-section' }, [
            h('h3', '测试操作'),
            h('button', { 
              class: 'button',
              onClick: this.testMermaidInsert 
            }, '测试插入 Mermaid'),
            h('button', { 
              class: 'button',
              onClick: this.clearOutput 
            }, '清空输出'),
          ]),
          
          h('div', { class: 'test-section' }, [
            h('h3', 'HTML 输出'),
            h('div', { class: 'output' }, this.htmlOutput || '暂无输出')
          ]),
          
          h('div', { class: 'test-section' }, [
            h('h3', 'JSON 输出'),
            h('div', { class: 'output' }, this.jsonOutput || '暂无输出')
          ]),
          
          h('div', { class: 'test-section' }, [
            h('h3', '测试日志'),
            h('div', { class: 'output' }, 
              this.testResults.length > 0 
                ? this.testResults.map(r => `[${r.timestamp}] ${r.result}`).join('\n')
                : '暂无测试记录'
            )
          ])
        ])
      }
    })

    app.mount('#app')
  </script>
</body>
</html>
